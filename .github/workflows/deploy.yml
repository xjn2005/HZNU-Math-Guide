# .github/workflows/deploy.yml

name: Deploy VitePress site to Pages

on:

  # 推送到 main 分支时触发

  push:

    branches: [main]

  # 允许手动触发

  workflow_dispatch:

permissions:

  contents: read

  pages: write

  id-token: write

concurrency:

  group: pages

  cancel-in-progress: false

jobs:

  build:

    runs-on: ubuntu-latest

    steps:

      - name: Checkout

        uses: actions/checkout@v4

        with:

          fetch-depth: 0  # 如果启用 lastUpdated 需要完整历史

      - name: Setup Node

        uses: actions/setup-node@v4

        with:

          node-version: 20  # 或 22 / 24，根据你 package.json

          cache: npm        # 或 pnpm / yarn

      - name: Setup Pages

        uses: actions/configure-pages@v5

      - name: Install dependencies

        run: npm ci

        working-directory: ./docs

      - name: Build with VitePress

        run: npm run build

        working-directory: ./docs

      - name: Upload artifact

        uses: actions/upload-pages-artifact@v3

        with:

          path: docs/.vitepress/dist  # 构建产物路径

  deploy:

    environment:

      name: github-pages

      url: ${{ steps.deployment.outputs.page_url }}

    runs-on: ubuntu-latest

    needs: build

    steps:

      - name: Deploy to GitHub Pages

        id: deployment

        uses: actions/deploy-pages@v4